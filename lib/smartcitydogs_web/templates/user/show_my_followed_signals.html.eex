<div class="fill-container-my-profile">
  <div class="register-photo">
    <div class="container">
      <div class="container-show-user">
      <br>
      <br />
      <br />
      <div class="container-filter">
        <ul class="list-unstyled">
          <li class="user-li">
            <label-headline>
              <center>МОЯТ ПРОФИЛ</center>
            </label-headline>
          </li>
          <li class="user-li">
            <label-li-text>
              <strong class="strong-show-user">Име:</strong><br />
              <%= @user.first_name %>
                <%= @user.last_name %>
            </label-li-text>
          </li>
          <br />
          <br>
          <li class="user-li">
            <label-li-text>
              <strong class="strong-show-user">Потребителско име:</strong><br />
              <%= @user.username %>
            </label-li-text>
          </li>
          <br>
          <br>
          <li class="user-li">
            <label-li-text>
              <strong class="strong-show-user">Телефонен номер:</strong><br />
              <%= @user.phone %> 
            </label-li-text>
          </li>
          <br />
          <br>
         
       
            <li class="user-li">
              <label-li-text>
                <strong class="strong-show-user">Имейл:</strong><br />
                <%= @user.email %> 
              </label-li-text>
            </li>
          <br>
            <li>
              
            </li>
            <div class="border-style-links-profile">
                <a class="profile-button-styles" onclick="showModalForm(event, 'change-info-form')" href="#">Промяна на данни</a>
              </div>
          </ul>
          </div>

            <div class="container-signals"> 
              <div class="border-style-links-profile">
                <a class="profile-button-styles" id="followed-signals-link" href="#">
                  Следени сигнали
                </a>
              </div>
              <div class="border-style-links-profile">    
                <a class="profile-button-styles" id="my-signals-link" href="#">
                  Моите сигнали
                </a>
              </div>
              <div class="signals-user-show">
              <%
              alias Smartcitydogs.DataSignals
                user = @conn.assigns.current_user.id
                signals = Smartcitydogs.DataSignals.get_all_followed_signals(user)
                ##IO.inspect signals
              ##  followed_signals = []
              ##  followed_signals = for sig <- signals, do: followed_signals ++ sig |> DataSignals.get_signal()
              ##  IO.inspect followed_signals
               ## page = Smartcitydogs.Repo.paginate(followed_signals, page: @page, page_size: 8)
              ##  IO.inspect page
              followed_signals = Smartcitydogs.DataSignals.get_signal_like(user)
                liked_signals = Enum.map(followed_signals, fn x -> x |> Map.get(:signals_id) end)
                #IO.inspect liked_signals
                followed_signals = []
                followed_signals = for sig <- liked_signals, do: followed_signals ++ sig |> DataSignals.get_signal()
                page = Smartcitydogs.Repo.paginate(followed_signals, page: @page, page_size: 8)
                profile_params = %{signals: signals, page: page, conn: @conn}
                
                ##profile_liked_params = %{signals: followed_signals, page: page, conn: @conn}
               ## IO.inspect profile_params
                
              %>
                <div class="last-signals-dogs-div">
                  <%= render SmartcitydogsWeb.MySignalsView, "my_signals.html", profile_params %>
                </div>
                <div class="last-signals-dogs-div2">
                 
<div class="row">
  
  <%= for followed_signal <- page.entries do %>
    <div class="col-lg-3">
      <div class="col-container" style="background-image: url('/<%= get_signals_images(followed_signal.id) %>')">
        <div class="col-container-shadow">

          <label-type class="
            <%= if followed_signal.signals_types_id == 1 do %>
            label-type-red
            <% end %>

            <%= if followed_signal.signals_types_id == 2 do %>
            label-type-orange
            <% end %>

            <%= if followed_signal.signals_types_id == 3 do %>
            label-type-yellow
            <% end %>

            <%= if followed_signal.signals_types_id == 4 do %>
            label-type-green
            <% end %>"><%=followed_signal.signals_types_id
            |> Smartcitydogs.DataSignals.get_signal_type()
            |> Map.get(:name)
          %>
          </label-type>
          <br />

          <label-date>
          <%=
            signal_time = followed_signal.inserted_at
            |> DateTime.truncate(:second)
            |> DateTime.to_string()
            count = String.length(signal_time)
            final_time = String.slice(signal_time,0..count-11)
            final_time
          %>
          <br />
          </label-date>

          <label-title><b>
          <%=
            followed_signal.signals_categories_id
            |> Smartcitydogs.DataSignals.get_signal_category()
            |> Map.get(:name)
          %></b></label-title>
          <br />


          <label-adress><%=
            followed_signal.address
          %></label-adress>
          <br />

            <div class="icon-scale">
              <i class="fas fa-search"></i> : <%=followed_signal.view_count%>
              <br />
            </div>
            <div class="icon-scale">
              <i class="fas fa-arrow-up"></i> : <span id="signal-count"><%= followed_signal.support_count %></span>
            </div>
            <div class="icon-scale">
              <i class="far fa-comment fa-flip-horizontal"></i> : <%= Enum.count(Smartcitydogs.DataSignals.get_comment_signal_id(followed_signal.id)) %>
            <br />
            </div>
          

            <center>

            <div class="button-show-hide">
               <%= link "Към сигнала", to: signal_path(@conn, :show, followed_signal.id), class: "btn btn-secondary" %>
            </div></center>
          </div>
         </div>
       </div>
    <%end%>
</div>

<style>
.last-signals-dogs-div2{
  display: inline-block;
}
</style>

<div class="padination">

  <%= for x <- 1..page.total_pages do %>
    <% 
   
    id = @conn.assigns.current_user.id
    %>
    <%= link "#{x * 8 - 7}-#{x * 8} ", to: user_path(@conn, :show, id, %{page: x, followed_signals: x}) %>
  <% end %>
</div>


                </div>
              </div>
              
              
            </div>

          </div>
      </div>
    </div>
  </div>
</div>